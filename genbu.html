<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¤ç‰©æ ¹éƒ¨å¸æ”¶æ°®ç£·é’¾åŠ¨æ€ç¤ºæ„å›¾</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow: auto;
        }
        
        h1 {
            color: #2c5530;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.95em;
        }
        
        .animation-container {
            width: 100%;
            height: 600px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 8px 16px;
            background-color: #4a7c59;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #3a6348;
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 12px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 5px;
            border-radius: 2px;
        }
        
        .stage-indicator {
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
            color: #4a7c59;
            min-height: 24px;
        }
        
        .info-panel {
            background-color: #f0f7f2;
            border-left: 4px solid #4a7c59;
            padding: 12px;
            margin-top: 15px;
            border-radius: 0 5px 5px 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .info-title {
            font-weight: bold;
            color: #2c5530;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ¤ç‰©æ ¹éƒ¨å¸æ”¶æ°®ã€ç£·ã€é’¾åŠ¨æ€ç¤ºæ„å›¾</h1>
        <div class="subtitle">å±•ç¤ºæ°®(N)ã€ç£·(P)ã€é’¾(K)ä¸‰ç§å…³é”®å…»åˆ†çš„å¸æ”¶æœºåˆ¶ä¸è·¯å¾„å·®å¼‚</div>
        
        <div class="stage-indicator" id="stageIndicator">é˜¶æ®µ 1/4: åˆå§‹çŠ¶æ€ - åœŸå£¤ä¸­çš„å…»åˆ†åˆ†å¸ƒ</div>
        
        <div class="animation-container" id="animationContainer">
            <!-- SVGåŠ¨ç”»å°†åœ¨è¿™é‡Œé€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="legend" id="legendContainer">
            <!-- å›¾ä¾‹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="info-panel" id="infoPanel">
            <div class="info-title">å½“å‰çŠ¶æ€è¯´æ˜</div>
            <div id="infoText">åˆå§‹çŠ¶æ€ï¼šå±•ç¤ºåœŸå£¤ä¸­çš„æ°®(N)ã€ç£·(P)ã€é’¾(K)å…»åˆ†åˆ†å¸ƒåŠæ¤ç‰©æ ¹ç³»ç»“æ„ã€‚</div>
        </div>
        
        <div class="controls">
            <button id="prevBtn">ä¸Šä¸€æ­¥</button>
            <button id="restartBtn">é‡æ–°å¼€å§‹</button>
            <button id="playBtn">æ’­æ”¾/æš‚åœ</button>
            <button id="nextBtn">ä¸‹ä¸€æ­¥</button>
            <button id="showAllBtn">æ˜¾ç¤ºå…¨éƒ¨è¿‡ç¨‹</button>
        </div>
    </div>

    <script>
        // SVGå°ºå¯¸å’Œé…ç½®
        const svgWidth = 1000;
        const svgHeight = 600;
        const soilColor = "#e6ccb3";
        const rootColor = "#8b4513";
        const rhizosphereColor = "rgba(139, 69, 19, 0.1)";
        
        // é¢œè‰²å®šä¹‰
        const nutrientColors = {
            nitrogen: {NH4: "#9b59b6", NO3: "#e67e22"},  // é“µæ€æ°®ç´«è‰²ï¼Œç¡æ€æ°®æ©™è‰²
            phosphorus: "#3498db",  // ç£·è“è‰²
            potassium: "#2ecc71",   // é’¾ç»¿è‰²
            hPlus: "#e74c3c",       // æ°¢ç¦»å­çº¢è‰²
            organicAcid: "#f1c40f", // æœ‰æœºé…¸é»„è‰²
            mycorrhiza: "#8e44ad"   // èŒæ ¹çœŸèŒç´«è‰²
        };
        
        // åŠ¨ç”»é˜¶æ®µå®šä¹‰
        const animationStages = [
            {
                name: "åˆå§‹çŠ¶æ€",
                description: "å±•ç¤ºåœŸå£¤ä¸­çš„æ°®(N)ã€ç£·(P)ã€é’¾(K)å…»åˆ†åˆ†å¸ƒåŠæ¤ç‰©æ ¹ç³»ç»“æ„ã€‚",
                duration: 3000
            },
            {
                name: "æ ¹é™…é…¸åŒ–è¿‡ç¨‹",
                description: "æ ¹ç³»åˆ†æ³ŒHâºè´¨å­ï¼Œé…¸åŒ–æ ¹é™…åœŸå£¤ï¼Œæ´»åŒ–è¢«å›ºå®šçš„ç£·ã€é’¾å…»åˆ†ã€‚",
                duration: 4000
            },
            {
                name: "æ°®(N)å¸æ”¶è¿‡ç¨‹",
                description: "é“µæ€æ°®(NHâ‚„âº)é€šè¿‡é“µè½¬è¿è›‹ç™½ç›´æ¥å¸æ”¶ï¼›ç¡æ€æ°®(NOâ‚ƒâ»)ä¸Hâºå…±è¿è¾“è¿›å…¥æ ¹ç»†èƒã€‚",
                duration: 4000
            },
            {
                name: "ç£·(P)å¸æ”¶è¿‡ç¨‹",
                description: "1) æ ¹ç³»åˆ†æ³Œæœ‰æœºé…¸æº¶è§£å›ºå®šæ€ç£·ï¼›2) èŒæ ¹çœŸèŒååŠ©å¸æ”¶è¿œå¤„ç£·ï¼›3) ç£·é…¸ç›é€šè¿‡å…±è¿è¾“è¿›å…¥ã€‚",
                duration: 4500
            },
            {
                name: "é’¾(K)å¸æ”¶è¿‡ç¨‹",
                description: "1) é’¾ç¦»å­(Kâº)é€šè¿‡ç¦»å­é€šé“å¿«é€Ÿæ‰©æ•£ï¼›2) é€šè¿‡è½½ä½“è›‹ç™½ä¸»åŠ¨è¿è¾“è¿›å…¥æ ¹ç»†èƒã€‚",
                duration: 4000
            },
            {
                name: "å®Œæ•´å¸æ”¶è¿‡ç¨‹",
                description: "æ°®ã€ç£·ã€é’¾ä¸‰ç§å…»åˆ†åŒæ—¶é€šè¿‡å„è‡ªæœºåˆ¶è¢«æ¤ç‰©æ ¹éƒ¨å¸æ”¶ï¼Œè¿›å…¥æœ¨è´¨éƒ¨å¯¼ç®¡å‘ä¸Šè¿è¾“ã€‚",
                duration: 5000
            }
        ];
        
        // å…¨å±€å˜é‡
        let currentStage = 0;
        let animationPlaying = false;
        let animationTimer = null;
        let svg;
        
        // åˆå§‹åŒ–SVG
        function initSVG() {
            const container = document.getElementById('animationContainer');
            container.innerHTML = '';
            
            svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.setAttribute("viewBox", `0 0 ${svgWidth} ${svgHeight}`);
            svg.style.backgroundColor = "#faf3e8";
            
            container.appendChild(svg);
            
            // åˆ›å»ºå›¾ä¾‹
            createLegend();
            
            // ç»˜åˆ¶é™æ€èƒŒæ™¯
            drawStaticBackground();
            
            // ç»˜åˆ¶åˆå§‹çŠ¶æ€
            drawStage(0);
        }
        
        // åˆ›å»ºå›¾ä¾‹
        function createLegend() {
            const legendContainer = document.getElementById('legendContainer');
            legendContainer.innerHTML = '';
            
            const legendItems = [
                {color: nutrientColors.nitrogen.NH4, text: "é“µæ€æ°® (NHâ‚„âº)"},
                {color: nutrientColors.nitrogen.NO3, text: "ç¡æ€æ°® (NOâ‚ƒâ»)"},
                {color: nutrientColors.phosphorus, text: "ç£· (Hâ‚‚POâ‚„â»)"},
                {color: nutrientColors.potassium, text: "é’¾ (Kâº)"},
                {color: nutrientColors.hPlus, text: "æ°¢ç¦»å­ (Hâº)"},
                {color: nutrientColors.organicAcid, text: "æœ‰æœºé…¸"},
                {color: nutrientColors.mycorrhiza, text: "èŒæ ¹çœŸèŒ"}
            ];
            
            legendItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'legend-item';
                
                const colorBox = document.createElement('div');
                colorBox.className = 'legend-color';
                colorBox.style.backgroundColor = item.color;
                
                const textSpan = document.createElement('span');
                textSpan.textContent = item.text;
                
                div.appendChild(colorBox);
                div.appendChild(textSpan);
                legendContainer.appendChild(div);
            });
        }
        
        // ç»˜åˆ¶é™æ€èƒŒæ™¯
        function drawStaticBackground() {
            // ç»˜åˆ¶åœŸå£¤èƒŒæ™¯
            const soil = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            soil.setAttribute("x", "0");
            soil.setAttribute("y", "200");
            soil.setAttribute("width", svgWidth.toString());
            soil.setAttribute("height", (svgHeight - 200).toString());
            soil.setAttribute("fill", soilColor);
            svg.appendChild(soil);
            
            // ç»˜åˆ¶åœŸå£¤åˆ†å±‚çº¿
            const soilLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
            soilLine.setAttribute("x1", "0");
            soilLine.setAttribute("y1", "200");
            soilLine.setAttribute("x2", svgWidth.toString());
            soilLine.setAttribute("y2", "200");
            soilLine.setAttribute("stroke", "#a67c52");
            soilLine.setAttribute("stroke-width", "2");
            soilLine.setAttribute("stroke-dasharray", "5,5");
            svg.appendChild(soilLine);
            
            // æ·»åŠ åœŸå£¤æ–‡å­—æ ‡ç­¾
            const soilLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            soilLabel.setAttribute("x", "50");
            soilLabel.setAttribute("y", "230");
            soilLabel.setAttribute("fill", "#7d5c3a");
            soilLabel.setAttribute("font-size", "16");
            soilLabel.setAttribute("font-weight", "bold");
            soilLabel.textContent = "åœŸå£¤å±‚";
            svg.appendChild(soilLabel);
            
            // ç»˜åˆ¶æ¤ç‰©æ ¹ç³»ï¼ˆé™æ€éƒ¨åˆ†ï¼‰
            drawRootSystem();
            
            // ç»˜åˆ¶æ ¹é™…åŒºåŸŸæŒ‡ç¤º
            const rhizosphere = document.createElementNS("http://www.w3.org/2000/svg", "ellipse");
            rhizosphere.setAttribute("cx", "250");
            rhizosphere.setAttribute("cy", "350");
            rhizosphere.setAttribute("rx", "180");
            rhizosphere.setAttribute("ry", "120");
            rhizosphere.setAttribute("fill", "none");
            rhizosphere.setAttribute("stroke", "#8b4513");
            rhizosphere.setAttribute("stroke-width", "2");
            rhizosphere.setAttribute("stroke-dasharray", "8,4");
            svg.appendChild(rhizosphere);
            
            const rhizosphereLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            rhizosphereLabel.setAttribute("x", "150");
            rhizosphereLabel.setAttribute("y", "320");
            rhizosphereLabel.setAttribute("fill", "#8b4513");
            rhizosphereLabel.setAttribute("font-size", "14");
            rhizosphereLabel.textContent = "æ ¹é™…åŒº";
            svg.appendChild(rhizosphereLabel);
            
            const bulkSoilLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            bulkSoilLabel.setAttribute("x", "700");
            bulkSoilLabel.setAttribute("y", "320");
            bulkSoilLabel.setAttribute("fill", "#8b4513");
            bulkSoilLabel.setAttribute("font-size", "14");
            bulkSoilLabel.textContent = "æœ¬ä½“åœŸ";
            svg.appendChild(bulkSoilLabel);
            
            // æ·»åŠ åˆ†éš”çº¿
            const separator = document.createElementNS("http://www.w3.org/2000/svg", "line");
            separator.setAttribute("x1", "500");
            separator.setAttribute("y1", "200");
            separator.setAttribute("x2", "500");
            separator.setAttribute("y2", svgHeight.toString());
            separator.setAttribute("stroke", "#a67c52");
            separator.setAttribute("stroke-width", "2");
            separator.setAttribute("stroke-dasharray", "10,5");
            svg.appendChild(separator);
            
            // æ·»åŠ å³ä¾§æ”¾å¤§åŒºåŸŸæ ‡ç­¾
            const zoomLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            zoomLabel.setAttribute("x", "750");
            zoomLabel.setAttribute("y", "230");
            zoomLabel.setAttribute("fill", "#7d5c3a");
            zoomLabel.setAttribute("font-size", "16");
            zoomLabel.setAttribute("font-weight", "bold");
            zoomLabel.textContent = "æ ¹æ¯›ç»†èƒå¸æ”¶è¿‡ç¨‹ï¼ˆæ”¾å¤§ï¼‰";
            svg.appendChild(zoomLabel);
        }
        
        // ç»˜åˆ¶æ ¹ç³»ç³»ç»Ÿ
        function drawRootSystem() {
            // ä¸»æ ¹
            const mainRoot = document.createElementNS("http://www.w3.org/2000/svg", "path");
            mainRoot.setAttribute("d", "M 200,100 C 180,200 160,300 150,400 C 140,500 160,580 180,590");
            mainRoot.setAttribute("fill", "none");
            mainRoot.setAttribute("stroke", rootColor);
            mainRoot.setAttribute("stroke-width", "10");
            svg.appendChild(mainRoot);
            
            // ä¾§æ ¹
            const sideRoots = [
                {d: "M 180,250 C 160,260 140,270 120,280", width: 6},
                {d: "M 190,350 C 170,360 150,370 110,390", width: 6},
                {d: "M 200,450 C 180,460 160,470 130,490", width: 6},
                {d: "M 220,300 C 240,310 260,320 280,330", width: 5},
                {d: "M 210,400 C 230,410 250,420 270,430", width: 5}
            ];
            
            sideRoots.forEach(root => {
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", root.d);
                path.setAttribute("fill", "none");
                path.setAttribute("stroke", rootColor);
                path.setAttribute("stroke-width", root.width.toString());
                svg.appendChild(path);
            });
            
            // æ ¹æ¯›åŒºåŸŸæŒ‡ç¤º
            const rootHairArea = document.createElementNS("http://www.w3.org/2000/svg", "ellipse");
            rootHairArea.setAttribute("cx", "180");
            rootHairArea.setAttribute("cy", "380");
            rootHairArea.setAttribute("rx", "40");
            rootHairArea.setAttribute("ry", "80");
            rootHairArea.setAttribute("fill", "none");
            rootHairArea.setAttribute("stroke", "#d2691e");
            rootHairArea.setAttribute("stroke-width", "2");
            rootHairArea.setAttribute("stroke-dasharray", "4,2");
            svg.appendChild(rootHairArea);
            
            const rootHairLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            rootHairLabel.setAttribute("x", "120");
            rootHairLabel.setAttribute("y", "360");
            rootHairLabel.setAttribute("fill", "#d2691e");
            rootHairLabel.setAttribute("font-size", "13");
            rootHairLabel.textContent = "æ ¹æ¯›å¯†é›†åŒº";
            svg.appendChild(rootHairLabel);
            
            // ç»˜åˆ¶æœ¨è´¨éƒ¨å¯¼ç®¡
            const xylem = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            xylem.setAttribute("x", "170");
            xylem.setAttribute("y", "50");
            xylem.setAttribute("width", "20");
            xylem.setAttribute("height", "550");
            xylem.setAttribute("fill", "none");
            xylem.setAttribute("stroke", "#2c5530");
            xylem.setAttribute("stroke-width", "4");
            svg.appendChild(xylem);
            
            const xylemLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            xylemLabel.setAttribute("x", "195");
            xylemLabel.setAttribute("y", "100");
            xylemLabel.setAttribute("fill", "#2c5530");
            xylemLabel.setAttribute("font-size", "14");
            xylemLabel.setAttribute("font-weight", "bold");
            xylemLabel.textContent = "æœ¨è´¨éƒ¨å¯¼ç®¡";
            svg.appendChild(xylemLabel);
            
            // æ·»åŠ å‘ä¸Šè¿è¾“ç®­å¤´
            const transportArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
            transportArrow.setAttribute("d", "M 180,550 L 180,100");
            transportArrow.setAttribute("fill", "none");
            transportArrow.setAttribute("stroke", "#2c5530");
            transportArrow.setAttribute("stroke-width", "2");
            transportArrow.setAttribute("marker-end", "url(#arrowhead)");
            svg.appendChild(transportArrow);
            
            // å®šä¹‰ç®­å¤´æ ‡è®°
            const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
            const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
            marker.setAttribute("id", "arrowhead");
            marker.setAttribute("markerWidth", "10");
            marker.setAttribute("markerHeight", "7");
            marker.setAttribute("refX", "9");
            marker.setAttribute("refY", "3.5");
            marker.setAttribute("orient", "auto");
            
            const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
            polygon.setAttribute("points", "0 0, 10 3.5, 0 7");
            polygon.setAttribute("fill", "#2c5530");
            
            marker.appendChild(polygon);
            defs.appendChild(marker);
            svg.appendChild(defs);
        }
        
        // ç»˜åˆ¶æ ¹æ¯›ç»†èƒæ”¾å¤§å›¾
        function drawRootCellZoom() {
            // ç»†èƒå¤–æ¡†
            const cell = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            cell.setAttribute("x", "600");
            cell.setAttribute("y", "250");
            cell.setAttribute("width", "350");
            cell.setAttribute("height", "300");
            cell.setAttribute("fill", "none");
            cell.setAttribute("stroke", "#333");
            cell.setAttribute("stroke-width", "3");
            svg.appendChild(cell);
            
            // ç»†èƒè†œ
            const cellMembrane = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            cellMembrane.setAttribute("x", "600");
            cellMembrane.setAttribute("y", "250");
            cellMembrane.setAttribute("width", "350");
            cellMembrane.setAttribute("height", "10");
            cellMembrane.setAttribute("fill", "#8b4513");
            svg.appendChild(cellMembrane);
            
            // ç»†èƒå†…éƒ¨åŒºåŸŸ
            const cytoplasm = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            cytoplasm.setAttribute("x", "610");
            cytoplasm.setAttribute("y", "260");
            cytoplasm.setAttribute("width", "330");
            cytoplasm.setAttribute("height", "280");
            cytoplasm.setAttribute("fill", "rgba(255, 255, 200, 0.3)");
            svg.appendChild(cytoplasm);
            
            // æ¶²æ³¡
            const vacuole = document.createElementNS("http://www.w3.org/2000/svg", "ellipse");
            vacuole.setAttribute("cx", "750");
            vacuole.setAttribute("cy", "400");
            vacuole.setAttribute("rx", "100");
            vacuole.setAttribute("ry", "80");
            vacuole.setAttribute("fill", "rgba(155, 89, 182, 0.2)");
            vacuole.setAttribute("stroke", "#9b59b6");
            vacuole.setAttribute("stroke-width", "2");
            svg.appendChild(vacuole);
            
            const vacuoleLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            vacuoleLabel.setAttribute("x", "740");
            vacuoleLabel.setAttribute("y", "400");
            vacuoleLabel.setAttribute("fill", "#9b59b6");
            vacuoleLabel.setAttribute("font-size", "14");
            vacuoleLabel.setAttribute("text-anchor", "middle");
            vacuoleLabel.textContent = "æ¶²æ³¡";
            svg.appendChild(vacuoleLabel);
            
            // æ ‡æ³¨
            const labels = [
                {x: 590, y: 255, text: "ç»†èƒè†œ", anchor: "end"},
                {x: 620, y: 280, text: "ç»†èƒè´¨", anchor: "start"},
                {x: 960, y: 260, text: "åœŸå£¤æº¶æ¶²", anchor: "start"}
            ];
            
            labels.forEach(label => {
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", label.x.toString());
                text.setAttribute("y", label.y.toString());
                text.setAttribute("fill", "#333");
                text.setAttribute("font-size", "13");
                text.setAttribute("text-anchor", label.anchor || "start");
                text.textContent = label.text;
                svg.appendChild(text);
            });
            
            // ç»˜åˆ¶å„ç§è½¬è¿è›‹ç™½ç¤ºæ„
            // è´¨å­æ³µ
            const protonPump = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            protonPump.setAttribute("x", "610");
            protonPump.setAttribute("y", "245");
            protonPump.setAttribute("width", "40");
            protonPump.setAttribute("height", "15");
            protonPump.setAttribute("fill", "#e74c3c");
            protonPump.setAttribute("rx", "3");
            svg.appendChild(protonPump);
            
            const protonPumpLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            protonPumpLabel.setAttribute("x", "630");
            protonPumpLabel.setAttribute("y", "240");
            protonPumpLabel.setAttribute("fill", "#c0392b");
            protonPumpLabel.setAttribute("font-size", "12");
            protonPumpLabel.setAttribute("text-anchor", "middle");
            protonPumpLabel.textContent = "Hâºæ³µ";
            svg.appendChild(protonPumpLabel);
            
            // é“µè½¬è¿è›‹ç™½
            const nh4Transporter = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            nh4Transporter.setAttribute("x", "670");
            nh4Transporter.setAttribute("y", "245");
            nh4Transporter.setAttribute("width", "40");
            nh4Transporter.setAttribute("height", "15");
            nh4Transporter.setAttribute("fill", "#9b59b6");
            nh4Transporter.setAttribute("rx", "3");
            svg.appendChild(nh4Transporter);
            
            // ç£·é…¸ç›è½¬è¿è›‹ç™½
            const phosphateTransporter = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            phosphateTransporter.setAttribute("x", "730");
            phosphateTransporter.setAttribute("y", "245");
            phosphateTransporter.setAttribute("width", "40");
            phosphateTransporter.setAttribute("height", "15");
            phosphateTransporter.setAttribute("fill", "#3498db");
            phosphateTransporter.setAttribute("rx", "3");
            svg.appendChild(phosphateTransporter);
            
            // é’¾ç¦»å­é€šé“
            const kChannel = document.createElementNS("http://www.w3.org/2000/svg", "ellipse");
            kChannel.setAttribute("cx", "800");
            kChannel.setAttribute("cy", "252");
            kChannel.setAttribute("rx", "20");
            kChannel.setAttribute("ry", "8");
            kChannel.setAttribute("fill", "#2ecc71");
            svg.appendChild(kChannel);
            
            // é’¾è½½ä½“è›‹ç™½
            const kTransporter = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            kTransporter.setAttribute("x", "850");
            kTransporter.setAttribute("y", "245");
            kTransporter.setAttribute("width", "40");
            kTransporter.setAttribute("height", "15");
            kTransporter.setAttribute("fill", "#27ae60");
            kTransporter.setAttribute("rx", "3");
            svg.appendChild(kTransporter);
            
            // ç¡æ€æ°®å…±è½¬è¿è›‹ç™½
            const no3Transporter = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            no3Transporter.setAttribute("x", "910");
            no3Transporter.setAttribute("y", "245");
            no3Transporter.setAttribute("width", "40");
            no3Transporter.setAttribute("height", "15");
            no3Transporter.setAttribute("fill", "#e67e22");
            no3Transporter.setAttribute("rx", "3");
            svg.appendChild(no3Transporter);
        }
        
        // ç»˜åˆ¶ç‰¹å®šé˜¶æ®µçš„åŠ¨ç”»
        function drawStage(stageIndex) {
            // æ¸…é™¤ä¹‹å‰çš„åŠ¨æ€å…ƒç´ 
            const dynamicElements = svg.querySelectorAll('.dynamic-element');
            dynamicElements.forEach(el => el.remove());
            
            currentStage = stageIndex;
            updateStageIndicator();
            updateInfoPanel();
            
            // ç»˜åˆ¶æ ¹æ¯›ç»†èƒæ”¾å¤§å›¾ï¼ˆé™¤äº†ç¬¬0é˜¶æ®µï¼‰
            if (stageIndex > 0) {
                drawRootCellZoom();
            }
            
            switch(stageIndex) {
                case 0: // åˆå§‹çŠ¶æ€ - å…»åˆ†åˆ†å¸ƒ
                    drawInitialNutrients();
                    break;
                case 1: // æ ¹é™…é…¸åŒ–
                    drawRhizosphereAcidification();
                    break;
                case 2: // æ°®å¸æ”¶
                    drawNitrogenUptake();
                    break;
                case 3: // ç£·å¸æ”¶
                    drawPhosphorusUptake();
                    break;
                case 4: // é’¾å¸æ”¶
                    drawPotassiumUptake();
                    break;
                case 5: // å®Œæ•´è¿‡ç¨‹
                    drawFullProcess();
                    break;
            }
        }
        
        // ç»˜åˆ¶åˆå§‹å…»åˆ†åˆ†å¸ƒ
        function drawInitialNutrients() {
            // åœ¨åœŸå£¤ä¸­ç»˜åˆ¶æ°®ã€ç£·ã€é’¾å…»åˆ†ç‚¹
            const nutrients = [];
            
            // é“µæ€æ°® (NH4+) - ç´«è‰²
            for (let i = 0; i < 25; i++) {
                nutrients.push({
                    type: 'NH4',
                    x: 50 + Math.random() * 400,
                    y: 250 + Math.random() * 300,
                    color: nutrientColors.nitrogen.NH4
                });
            }
            
            // ç¡æ€æ°® (NO3-) - æ©™è‰²
            for (let i = 0; i < 20; i++) {
                nutrients.push({
                    type: 'NO3',
                    x: 100 + Math.random() * 350,
                    y: 250 + Math.random() * 300,
                    color: nutrientColors.nitrogen.NO3
                });
            }
            
            // ç£· (H2PO4-) - è“è‰²
            for (let i = 0; i < 15; i++) {
                nutrients.push({
                    type: 'P',
                    x: 300 + Math.random() * 150,
                    y: 300 + Math.random() * 200,
                    color: nutrientColors.phosphorus
                });
            }
            
            // é’¾ (K+) - ç»¿è‰²
            for (let i = 0; i < 30; i++) {
                nutrients.push({
                    type: 'K',
                    x: 50 + Math.random() * 400,
                    y: 250 + Math.random() * 300,
                    color: nutrientColors.potassium
                });
            }
            
            // ç»˜åˆ¶å›ºå®šæ€ç£·ï¼ˆè¢«åœŸå£¤é¢—ç²’å¸é™„ï¼‰
            for (let i = 0; i < 8; i++) {
                const fixedP = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                const x = 350 + Math.random() * 100;
                const y = 350 + Math.random() * 150;
                fixedP.setAttribute("x", x.toString());
                fixedP.setAttribute("y", y.toString());
                fixedP.setAttribute("width", "20");
                fixedP.setAttribute("height", "20");
                fixedP.setAttribute("fill", "#95a5a6");
                fixedP.setAttribute("rx", "3");
                fixedP.classList.add('dynamic-element');
                svg.appendChild(fixedP);
                
                // æ·»åŠ é”å½¢å›¾æ ‡
                const lock = document.createElementNS("http://www.w3.org/2000/svg", "text");
                lock.setAttribute("x", (x + 10).toString());
                lock.setAttribute("y", (y + 15).toString());
                lock.setAttribute("fill", "#7f8c8d");
                lock.setAttribute("font-size", "14");
                lock.setAttribute("text-anchor", "middle");
                lock.setAttribute("font-weight", "bold");
                lock.textContent = "ğŸ”’";
                lock.classList.add('dynamic-element');
                svg.appendChild(lock);
            }
            
            // ç»˜åˆ¶æ‰€æœ‰å¯ç§»åŠ¨å…»åˆ†ç‚¹
            nutrients.forEach(nutrient => {
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", nutrient.x.toString());
                circle.setAttribute("cy", nutrient.y.toString());
                circle.setAttribute("r", "6");
                circle.setAttribute("fill", nutrient.color);
                circle.setAttribute("opacity", "0.8");
                circle.classList.add('dynamic-element');
                svg.appendChild(circle);
                
                // æ·»åŠ å…»åˆ†ç±»å‹æ ‡ç­¾
                const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
                label.setAttribute("x", nutrient.x.toString());
                label.setAttribute("y", (nutrient.y - 10).toString());
                label.setAttribute("fill", nutrient.color);
                label.setAttribute("font-size", "12");
                label.setAttribute("text-anchor", "middle");
                label.setAttribute("font-weight", "bold");
                
                if (nutrient.type === 'NH4') label.textContent = "NHâ‚„âº";
                else if (nutrient.type === 'NO3') label.textContent = "NOâ‚ƒâ»";
                else if (nutrient.type === 'P') label.textContent = "Hâ‚‚POâ‚„â»";
                else if (nutrient.type === 'K') label.textContent = "Kâº";
                
                label.classList.add('dynamic-element');
                svg.appendChild(label);
            });
            
            // æ·»åŠ èŒæ ¹çœŸèŒç¤ºæ„ï¼ˆé™æ€ï¼‰
            const mycorrhiza = document.createElementNS("http://www.w3.org/2000/svg", "path");
            mycorrhiza.setAttribute("d", "M 400,450 C 450,430 500,410 550,400 C 600,390 650,400 700,420");
            mycorrhiza.setAttribute("fill", "none");
            mycorrhiza.setAttribute("stroke", nutrientColors.mycorrhiza);
            mycorrhiza.setAttribute("stroke-width", "3");
            mycorrhiza.setAttribute("stroke-dasharray", "5,3");
            mycorrhiza.classList.add('dynamic-element');
            svg.appendChild(mycorrhiza);
            
            // æ·»åŠ èŒæ ¹çœŸèŒç½‘ç»œæ ‡ç­¾
            const mycorrhizaLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            mycorrhizaLabel.setAttribute("x", "580");
            mycorrhizaLabel.setAttribute("y", "380");
            mycorrhizaLabel.setAttribute("fill", nutrientColors.mycorrhiza);
            mycorrhizaLabel.setAttribute("font-size", "13");
            mycorrhizaLabel.textContent = "èŒæ ¹çœŸèŒèŒä¸ç½‘ç»œ";
            mycorrhizaLabel.classList.add('dynamic-element');
            svg.appendChild(mycorrhizaLabel);
        }
        
        // ç»˜åˆ¶æ ¹é™…é…¸åŒ–è¿‡ç¨‹
        function drawRhizosphereAcidification() {
            // ç»˜åˆ¶ä»æ ¹æ¯›ç»†èƒåˆ†æ³Œçš„H+è´¨å­
            for (let i = 0; i < 15; i++) {
                const hPlus = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                const startX = 180 + Math.random() * 40;
                const startY = 380 + Math.random() * 80;
                hPlus.setAttribute("cx", startX.toString());
                hPlus.setAttribute("cy", startY.toString());
                hPlus.setAttribute("r", "4");
                hPlus.setAttribute("fill", nutrientColors.hPlus);
                hPlus.classList.add('dynamic-element');
                svg.appendChild(hPlus);
                
                // æ·»åŠ H+æ ‡ç­¾
                const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
                label.setAttribute("x", startX.toString());
                label.setAttribute("y", (startY - 8).toString());
                label.setAttribute("fill", nutrientColors.hPlus);
                label.setAttribute("font-size", "10");
                label.setAttribute("text-anchor", "middle");
                label.setAttribute("font-weight", "bold");
                label.textContent = "Hâº";
                label.classList.add('dynamic-element');
                svg.appendChild(label);
                
                // æ·»åŠ H+å‘å¤–æ‰©æ•£çš„åŠ¨ç”»
                hPlus.style.animation = `hplusDiffuse 2s ${i * 0.1}s infinite alternate`;
            }
            
            // æ·»åŠ CSSåŠ¨ç”»å®šä¹‰
            const style = document.createElementNS("http://www.w3.org/2000/svg", "style");
            style.textContent = `
                @keyframes hplusDiffuse {
                    0% { transform: translate(0, 0); opacity: 1; }
                    100% { transform: translate(${20 + Math.random() * 30}, ${-10 - Math.random() * 20}); opacity: 0.3; }
                }
            `;
            svg.appendChild(style);
            
            // ç»˜åˆ¶æ ¹é™…pHé™ä½çš„ç¤ºæ„åŒºåŸŸ
            const acidZone = document.createElementNS("http://www.w3.org/2000/svg", "ellipse");
            acidZone.setAttribute("cx", "220");
            acidZone.setAttribute("cy", "380");
            acidZone.setAttribute("rx", "100");
            acidZone.setAttribute("ry", "70");
            acidZone.setAttribute("fill", "rgba(231, 76, 60, 0.2)");
            acidZone.setAttribute("stroke", nutrientColors.hPlus);
            acidZone.setAttribute("stroke-width", "2");
            acidZone.setAttribute("stroke-dasharray", "5,3");
            acidZone.classList.add('dynamic-element');
            svg.appendChild(acidZone);
            
            // æ·»åŠ æ ¹é™…é…¸åŒ–æ ‡ç­¾
            const acidLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            acidLabel.setAttribute("x", "220");
            acidLabel.setAttribute("y", "350");
            acidLabel.setAttribute("fill", nutrientColors.hPlus);
            acidLabel.setAttribute("font-size", "14");
            acidLabel.setAttribute("text-anchor", "middle");
            acidLabel.setAttribute("font-weight", "bold");
            acidLabel.textContent = "æ ¹é™…é…¸åŒ–åŒºåŸŸ (pHé™ä½)";
            acidLabel.classList.add('dynamic-element');
            svg.appendChild(acidLabel);
            
            // ç»˜åˆ¶è¢«é…¸è§£é‡Šæ”¾çš„ç£·
            const releasedP = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            releasedP.setAttribute("cx", "350");
            releasedP.setAttribute("cy", "380");
            releasedP.setAttribute("r", "8");
            releasedP.setAttribute("fill", nutrientColors.phosphorus);
            releasedP.classList.add('dynamic-element');
            svg.appendChild(releasedP);
            
            const releasedPLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            releasedPLabel.setAttribute("x", "350");
            releasedPLabel.setAttribute("y", "370");
            releasedPLabel.setAttribute("fill", nutrientColors.phosphorus);
            releasedPLabel.setAttribute("font-size", "12");
            releasedPLabel.setAttribute("text-anchor", "middle");
            releasedPLabel.setAttribute("font-weight", "bold");
            releasedPLabel.textContent = "Hâ‚‚POâ‚„â»";
            releasedPLabel.classList.add('dynamic-element');
            svg.appendChild(releasedPLabel);
            
            // æ·»åŠ ä»å›ºå®šæ€ç£·é‡Šæ”¾çš„åŠ¨ç”»ç®­å¤´
            const releaseArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
            releaseArrow.setAttribute("d", "M 320,380 L 340,380");
            releaseArrow.setAttribute("fill", "none");
            releaseArrow.setAttribute("stroke", nutrientColors.phosphorus);
            releaseArrow.setAttribute("stroke-width", "2");
            releaseArrow.setAttribute("marker-end", "url(#arrowhead)");
            releaseArrow.classList.add('dynamic-element');
            svg.appendChild(releaseArrow);
        }
        
        // ç»˜åˆ¶æ°®å¸æ”¶è¿‡ç¨‹
        function drawNitrogenUptake() {
            drawRhizosphereAcidification(); // åŒ…å«æ ¹é™…é…¸åŒ–èƒŒæ™¯
            
            // ç»˜åˆ¶é“µæ€æ°®(NH4+)å¸æ”¶
            for (let i = 0; i < 5; i++) {
                const nh4 = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                nh4.setAttribute("cx", (150 + i * 20).toString());
                nh4.setAttribute("cy", (350 + i * 10).toString());
                nh4.setAttribute("r", "6");
                nh4.setAttribute("fill", nutrientColors.nitrogen.NH4);
                nh4.classList.add('dynamic-element');
                svg.appendChild(nh4);
                
                // é“µæ€æ°®å¸æ”¶ç®­å¤´ï¼ˆè¿›å…¥æ ¹æ¯›ï¼‰
                const nh4Arrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
                nh4Arrow.setAttribute("d", `M ${150 + i * 20} ${350 + i * 10} L ${180} ${380}`);
                nh4Arrow.setAttribute("fill", "none");
                nh4Arrow.setAttribute("stroke", nutrientColors.nitrogen.NH4);
                nh4Arrow.setAttribute("stroke-width", "2");
                nh4Arrow.setAttribute("marker-end", "url(#arrowhead)");
                nh4Arrow.style.animation = `arrowFlow 2s ${i * 0.3}s infinite`;
                nh4Arrow.classList.add('dynamic-element');
                svg.appendChild(nh4Arrow);
            }
            
            // ç»˜åˆ¶ç¡æ€æ°®(NO3-)ä¸H+å…±è¿è¾“
            for (let i = 0; i < 5; i++) {
                const no3 = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                no3.setAttribute("cx", (250 + i * 15).toString());
                no3.setAttribute("cy", (320 + i * 15).toString());
                no3.setAttribute("r", "6");
                no3.setAttribute("fill", nutrientColors.nitrogen.NO3);
                no3.classList.add('dynamic-element');
                svg.appendChild(no3);
                
                // H+ç¦»å­ï¼ˆå…±è¿è¾“ï¼‰
                const hPlus = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                hPlus.setAttribute("cx", (245 + i * 15).toString());
                hPlus.setAttribute("cy", (335 + i * 15).toString());
                hPlus.setAttribute("r", "4");
                hPlus.setAttribute("fill", nutrientColors.hPlus);
                hPlus.classList.add('dynamic-element');
                svg.appendChild(hPlus);
                
                // ç¡æ€æ°®ä¸H+å…±è¿è¾“ç®­å¤´
                const no3Arrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
                no3Arrow.setAttribute("d", `M ${250 + i * 15} ${320 + i * 15} L ${200} ${390}`);
                no3Arrow.setAttribute("fill", "none");
                no3Arrow.setAttribute("stroke", nutrientColors.nitrogen.NO3);
                no3Arrow.setAttribute("stroke-width", "2");
                no3Arrow.setAttribute("stroke-dasharray", "5,3");
                no3Arrow.setAttribute("marker-end", "url(#arrowhead)");
                no3Arrow.style.animation = `arrowFlow 2s ${i * 0.4}s infinite`;
                no3Arrow.classList.add('dynamic-element');
                svg.appendChild(no3Arrow);
            }
            
            // åœ¨æ ¹æ¯›ç»†èƒæ”¾å¤§å›¾ä¸­ç»˜åˆ¶æ°®å¸æ”¶è¿‡ç¨‹
            // é“µæ€æ°®é€šè¿‡è½¬è¿è›‹ç™½è¿›å…¥ç»†èƒ
            const nh4CellArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
            nh4CellArrow.setAttribute("d", "M 690,260 L 690,280");
            nh4CellArrow.setAttribute("fill", "none");
            nh4CellArrow.setAttribute("stroke", nutrientColors.nitrogen.NH4);
            nh4CellArrow.setAttribute("stroke-width", "3");
            nh4CellArrow.setAttribute("marker-end", "url(#arrowhead)");
            nh4CellArrow.style.animation = "arrowFlow 1.5s infinite";
            nh4CellArrow.classList.add('dynamic-element');
            svg.appendChild(nh4CellArrow);
            
            // ç¡æ€æ°®ä¸H+å…±è¿è¾“è¿›å…¥ç»†èƒ
            const no3CellArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
            no3CellArrow.setAttribute("d", "M 930,260 L 930,280");
            no3CellArrow.setAttribute("fill", "none");
            no3CellArrow.setAttribute("stroke", nutrientColors.nitrogen.NO3);
            no3CellArrow.setAttribute("stroke-width", "3");
            no3CellArrow.setAttribute("marker-end", "url(#arrowhead)");
            no3CellArrow.style.animation = "arrowFlow 1.5s 0.5s infinite";
            no3CellArrow.classList.add('dynamic-element');
            svg.appendChild(no3CellArrow);
            
            // H+ä¸ç¡æ€æ°®ä¸€èµ·è¿›å…¥ç»†èƒ
            const hPlusCellArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
            hPlusCellArrow.setAttribute("d", "M 935,260 L 935,280");
            hPlusCellArrow.setAttribute("fill", "none");
            hPlusCellArrow.setAttribute("stroke", nutrientColors.hPlus);
            hPlusCellArrow.setAttribute("stroke-width", "2");
            hPlusCellArrow.setAttribute("marker-end", "url(#arrowhead)");
            hPlusCellArrow.style.animation = "arrowFlow 1.5s 0.5s infinite";
            hPlusCellArrow.classList.add('dynamic-element');
            svg.appendChild(hPlusCellArrow);
            
            // æ·»åŠ CSSåŠ¨ç”»
            const style = document.createElementNS("http://www.w3.org/2000/svg", "style");
            style.textContent = `
                @keyframes arrowFlow {
                    0% { opacity: 0; }
                    50% { opacity: 1; }
                    100% { opacity: 0; }
                }
            `;
            svg.appendChild(style);
            
            // æ·»åŠ æ°®å¸æ”¶æ ‡ç­¾
            const nUptakeLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            nUptakeLabel.setAttribute("x", "200");
            nUptakeLabel.setAttribute("y", "300");
            nUptakeLabel.setAttribute("fill", nutrientColors.nitrogen.NH4);
            nUptakeLabel.setAttribute("font-size", "15");
            nUptakeLabel.setAttribute("text-anchor", "middle");
            nUptakeLabel.setAttribute("font-weight", "bold");
            nUptakeLabel.textContent = "æ°®(N)å¸æ”¶è¿‡ç¨‹";
            nUptakeLabel.classList.add('dynamic-element');
            svg.appendChild(nUptakeLabel);
        }
        
        // ç»˜åˆ¶ç£·å¸æ”¶è¿‡ç¨‹
        function drawPhosphorusUptake() {
            drawRhizosphereAcidification(); // åŒ…å«æ ¹é™…é…¸åŒ–èƒŒæ™¯
            
            // ç»˜åˆ¶æœ‰æœºé…¸åˆ†æ³Œ
            for (let i = 0; i < 8; i++) {
                const organicAcid = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                organicAcid.setAttribute("cx", (170 + i * 5).toString());
                organicAcid.setAttribute("cy", (400 + i * 3).toString());
                organicAcid.setAttribute("r", "5");
                organicAcid.setAttribute("fill", nutrientColors.organicAcid);
                organicAcid.classList.add('dynamic-element');
                svg.appendChild(organicAcid);
                
                // æœ‰æœºé…¸æ‰©æ•£ç®­å¤´
                const acidArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
                acidArrow.setAttribute("d", `M ${170 + i * 5} ${400 + i * 3} L ${340 + i * 10} ${380}`);
                acidArrow.setAttribute("fill", "none");
                acidArrow.setAttribute("stroke", nutrientColors.organicAcid);
                acidArrow.setAttribute("stroke-width", "1.5");
                acidArrow.setAttribute("stroke-dasharray", "3,2");
                acidArrow.style.animation = `arrowFlow 3s ${i * 0.2}s infinite`;
                acidArrow.classList.add('dynamic-element');
                svg.appendChild(acidArrow);
            }
            
            // ç»˜åˆ¶è¢«æœ‰æœºé…¸é‡Šæ”¾çš„ç£·
            const releasedP = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            releasedP.setAttribute("cx", "350");
            releasedP.setAttribute("cy", "380");
            releasedP.setAttribute("r", "8");
            releasedP.setAttribute("fill", nutrientColors.phosphorus);
            releasedP.style.animation = "pulse 1.5s infinite";
            releasedP.classList.add('dynamic-element');
            svg.appendChild(releasedP);
            
            // ç£·å¸æ”¶ç®­å¤´ï¼ˆè¿›å…¥æ ¹æ¯›ï¼‰
            const pArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
            pArrow.setAttribute("d", "M 350 380 L 200 400");
            pArrow.setAttribute("fill", "none");
            pArrow.setAttribute("stroke", nutrientColors.phosphorus);
            pArrow.setAttribute("stroke-width", "3");
            pArrow.setAttribute("marker-end", "url(#arrowhead)");
            pArrow.style.animation = "arrowFlow 2s infinite";
            pArrow.classList.add('dynamic-element');
            svg.appendChild(pArrow);
            
            // ç»˜åˆ¶èŒæ ¹çœŸèŒååŠ©å¸æ”¶è¿œå¤„ç£·
            const distantP = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            distantP.setAttribute("cx", "650");
            distantP.setAttribute("cy", "420");
            distantP.setAttribute("r", "8");
            distantP.setAttribute("fill", nutrientColors.phosphorus);
            distantP.classList.add('dynamic-element');
            svg.appendChild(distantP);
            
            const distantPLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            distantPLabel.setAttribute("x", "650");
            distantPLabel.setAttribute("y", "410");
            distantPLabel.setAttribute("fill", nutrientColors.phosphorus);
            distantPLabel.setAttribute("font-size", "12");
            distantPLabel.setAttribute("text-anchor", "middle");
            distantPLabel.setAttribute("font-weight", "bold");
            distantPLabel.textContent = "Hâ‚‚POâ‚„â»";
            distantPLabel.classList.add('dynamic-element');
            svg.appendChild(distantPLabel);
            
            // èŒæ ¹çœŸèŒè¿è¾“ç£·çš„ç®­å¤´
            const mycorrhizaArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
            mycorrhizaArrow.setAttribute("d", "M 650 420 L 550 420 L 500 400 L 400 410");
            mycorrhizaArrow.setAttribute("fill", "none");
            mycorrhizaArrow.setAttribute("stroke", nutrientColors.mycorrhiza);
            mycorrhizaArrow.setAttribute("stroke-width", "2");
            mycorrhizaArrow.setAttribute("marker-end", "url(#arrowhead)");
            mycorrhizaArrow.style.animation = "arrowFlow 3s infinite";
            mycorrhizaArrow.classList.add('dynamic-element');
            svg.appendChild(mycorrhizaArrow);
            
            // åœ¨æ ¹æ¯›ç»†èƒæ”¾å¤§å›¾ä¸­ç»˜åˆ¶ç£·å¸æ”¶
            const pCellArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
            pCellArrow.setAttribute("d", "M 750,260 L 750,280");
            pCellArrow.setAttribute("fill", "none");
            pCellArrow.setAttribute("stroke", nutrientColors.phosphorus);
            pCellArrow.setAttribute("stroke-width", "3");
            pCellArrow.setAttribute("marker-end", "url(#arrowhead)");
            pCellArrow.style.animation = "arrowFlow 1.5s 0.3s infinite";
            pCellArrow.classList.add('dynamic-element');
            svg.appendChild(pCellArrow);
            
            // æ·»åŠ H+ä¸ç£·å…±è¿è¾“
            const hPlusForP = document.createElementNS("http://www.w3.org/2000/svg", "path");
            hPlusForP.setAttribute("d", "M 745,260 L 745,280");
            hPlusForP.setAttribute("fill", "none");
            hPlusForP.setAttribute("stroke", nutrientColors.hPlus);
            hPlusForP.setAttribute("stroke-width", "2");
            hPlusForP.setAttribute("marker-end", "url(#arrowhead)");
            hPlusForP.style.animation = "arrowFlow 1.5s 0.3s infinite";
            hPlusForP.classList.add('dynamic-element');
            svg.appendChild(hPlusForP);
            
            // æ·»åŠ ç£·å¸æ”¶æ ‡ç­¾
            const pUptakeLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            pUptakeLabel.setAttribute("x", "200");
            pUptakeLabel.setAttribute("y", "300");
            pUptakeLabel.setAttribute("fill", nutrientColors.phosphorus);
            pUptakeLabel.setAttribute("font-size", "15");
            pUptakeLabel.setAttribute("text-anchor", "middle");
            pUptakeLabel.setAttribute("font-weight", "bold");
            pUptakeLabel.textContent = "ç£·(P)å¸æ”¶è¿‡ç¨‹";
            pUptakeLabel.classList.add('dynamic-element');
            svg.appendChild(pUptakeLabel);
            
            // æ·»åŠ CSSåŠ¨ç”»
            const style = document.createElementNS("http://www.w3.org/2000/svg", "style");
            style.textContent = `
                @keyframes pulse {
                    0% { r: 8; }
                    50% { r: 10; }
                    100% { r: 8; }
                }
            `;
            svg.appendChild(style);
        }
        
        // ç»˜åˆ¶é’¾å¸æ”¶è¿‡ç¨‹
        function drawPotassiumUptake() {
            drawRhizosphereAcidification(); // åŒ…å«æ ¹é™…é…¸åŒ–èƒŒæ™¯
            
            // ç»˜åˆ¶é’¾ç¦»å­(K+)åˆ†å¸ƒ
            for (let i = 0; i < 12; i++) {
                const kPlus = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                kPlus.setAttribute("cx", (100 + i * 25).toString());
                kPlus.setAttribute("cy", (350 + Math.sin(i) * 40).toString());
                kPlus.setAttribute("r", "6");
                kPlus.setAttribute("fill", nutrientColors.potassium);
                kPlus.classList.add('dynamic-element');
                svg.appendChild(kPlus);
                
                // é’¾ç¦»å­æ ‡ç­¾
                const kLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
                kLabel.setAttribute("x", (100 + i * 25).toString());
                kLabel.setAttribute("y", (340 + Math.sin(i) * 40).toString());
                kLabel.setAttribute("fill", nutrientColors.potassium);
                kLabel.setAttribute("font-size", "11");
                kLabel.setAttribute("text-anchor", "middle");
                kLabel.setAttribute("font-weight", "bold");
                kLabel.textContent = "Kâº";
                kLabel.classList.add('dynamic-element');
                svg.appendChild(kLabel);
                
                // é’¾ç¦»å­å¸æ”¶ç®­å¤´ï¼ˆé€šé“è¿è¾“ï¼‰
                if (i % 2 === 0) {
                    const kChannelArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    kChannelArrow.setAttribute("d", `M ${100 + i * 25} ${350 + Math.sin(i) * 40} L ${180} ${380}`);
                    kChannelArrow.setAttribute("fill", "none");
                    kChannelArrow.setAttribute("stroke", nutrientColors.potassium);
                    kChannelArrow.setAttribute("stroke-width", "2");
                    kChannelArrow.setAttribute("marker-end", "url(#arrowhead)");
                    kChannelArrow.style.animation = `arrowFlow 2s ${i * 0.2}s infinite`;
                    kChannelArrow.classList.add('dynamic-element');
                    svg.appendChild(kChannelArrow);
                }
                // é’¾ç¦»å­å¸æ”¶ç®­å¤´ï¼ˆè½½ä½“è›‹ç™½ä¸»åŠ¨è¿è¾“ï¼‰
                else {
                    const kTransporterArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    kTransporterArrow.setAttribute("d", `M ${100 + i * 25} ${350 + Math.sin(i) * 40} L ${190} ${390}`);
                    kTransporterArrow.setAttribute("fill", "none");
                    kTransporterArrow.setAttribute("stroke", nutrientColors.potassium);
                    kTransporterArrow.setAttribute("stroke-width", "2");
                    kTransporterArrow.setAttribute("stroke-dasharray", "5,3");
                    kTransporterArrow.setAttribute("marker-end", "url(#arrowhead)");
                    kTransporterArrow.style.animation = `arrowFlow 2.5s ${i * 0.3}s infinite`;
                    kTransporterArrow.classList.add('dynamic-element');
                    svg.appendChild(kTransporterArrow);
                    
                    // ä¼´éšH+æ’å‡ºçš„åå‘ç®­å¤´ï¼ˆä¸»åŠ¨è¿è¾“çš„ç‰¹å¾ï¼‰
                    const hPlusExportArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    hPlusExportArrow.setAttribute("d", `M ${190} ${390} L ${100 + i * 25} ${350 + Math.sin(i) * 40}`);
                    hPlusExportArrow.setAttribute("fill", "none");
                    hPlusExportArrow.setAttribute("stroke", nutrientColors.hPlus);
                    hPlusExportArrow.setAttribute("stroke-width", "1.5");
                    hPlusExportArrow.setAttribute("marker-end", "url(#arrowhead)");
                    hPlusExportArrow.style.animation = `arrowFlow 2.5s ${i * 0.3}s infinite`;
                    hPlusExportArrow.classList.add('dynamic-element');
                    svg.appendChild(hPlusExportArrow);
                }
            }
            
            // åœ¨æ ¹æ¯›ç»†èƒæ”¾å¤§å›¾ä¸­ç»˜åˆ¶é’¾å¸æ”¶
            // é’¾ç¦»å­é€šé“è¿è¾“
            const kChannelArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
            kChannelArrow.setAttribute("d", "M 800,260 L 800,280");
            kChannelArrow.setAttribute("fill", "none");
            kChannelArrow.setAttribute("stroke", nutrientColors.potassium);
            kChannelArrow.setAttribute("stroke-width", "3");
            kChannelArrow.setAttribute("marker-end", "url(#arrowhead)");
            kChannelArrow.style.animation = "arrowFlow 1s infinite";
            kChannelArrow.classList.add('dynamic-element');
            svg.appendChild(kChannelArrow);
            
            // é’¾ç¦»å­è½½ä½“è›‹ç™½ä¸»åŠ¨è¿è¾“
            const kTransporterArrow = document.createElementNS("http://www.w3.org/2000/svg", "path");
            kTransporterArrow.setAttribute("d", "M 870,260 L 870,280");
            kTransporterArrow.setAttribute("fill", "none");
            kTransporterArrow.setAttribute("stroke", nutrientColors.potassium);
            kTransporterArrow.setAttribute("stroke-width", "3");
            kTransporterArrow.setAttribute("stroke-dasharray", "5,3");
            kTransporterArrow.setAttribute("marker-end", "url(#arrowhead)");
            kTransporterArrow.style.animation = "arrowFlow 1.5s 0.5s infinite";
            kTransporterArrow.classList.add('dynamic-element');
            svg.appendChild(kTransporterArrow);
            
            // H+æ’å‡ºï¼ˆä¸K+ä¸»åŠ¨è¿è¾“è€¦è”ï¼‰
            const hPlusExport = document.createElementNS("http://www.w3.org/2000/svg", "path");
            hPlusExport.setAttribute("d", "M 865,280 L 865,260");
            hPlusExport.setAttribute("fill", "none");
            hPlusExport.setAttribute("stroke", nutrientColors.hPlus);
            hPlusExport.setAttribute("stroke-width", "2");
            hPlusExport.setAttribute("marker-end", "url(#arrowhead)");
            hPlusExport.style.animation = "arrowFlow 1.5s 0.5s infinite";
            hPlusExport.classList.add('dynamic-element');
            svg.appendChild(hPlusExport);
            
            // æ·»åŠ é’¾å¸æ”¶æ ‡ç­¾
            const kUptakeLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            kUptakeLabel.setAttribute("x", "200");
            kUptakeLabel.setAttribute("y", "300");
            kUptakeLabel.setAttribute("fill", nutrientColors.potassium);
            kUptakeLabel.setAttribute("font-size", "15");
            kUptakeLabel.setAttribute("text-anchor", "middle");
            kUptakeLabel.setAttribute("font-weight", "bold");
            kUptakeLabel.textContent = "é’¾(K)å¸æ”¶è¿‡ç¨‹";
            kUptakeLabel.classList.add('dynamic-element');
            svg.appendChild(kUptakeLabel);
        }
        
        // ç»˜åˆ¶å®Œæ•´å¸æ”¶è¿‡ç¨‹
        function drawFullProcess() {
            // ç»˜åˆ¶æ‰€æœ‰è¿‡ç¨‹
            drawNitrogenUptake();
            drawPhosphorusUptake();
            drawPotassiumUptake();
            
            // ç§»é™¤å„å•ç‹¬è¿‡ç¨‹çš„æ ‡é¢˜ï¼Œæ·»åŠ æ€»æ ‡é¢˜
            const titles = svg.querySelectorAll('text[dynamic-element]');
            titles.forEach(title => {
                if (title.textContent.includes("å¸æ”¶è¿‡ç¨‹")) {
                    title.remove();
                }
            });
            
            // æ·»åŠ å®Œæ•´è¿‡ç¨‹æ€»æ ‡é¢˜
            const fullProcessLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            fullProcessLabel.setAttribute("x", "200");
            fullProcessLabel.setAttribute("y", "300");
            fullProcessLabel.setAttribute("fill", "#2c5530");
            fullProcessLabel.setAttribute("font-size", "16");
            fullProcessLabel.setAttribute("text-anchor", "middle");
            fullProcessLabel.setAttribute("font-weight", "bold");
            fullProcessLabel.textContent = "æ°®ã€ç£·ã€é’¾å®Œæ•´å¸æ”¶è¿‡ç¨‹";
            fullProcessLabel.classList.add('dynamic-element');
            svg.appendChild(fullProcessLabel);
            
            // æ·»åŠ å…»åˆ†è¿›å…¥æœ¨è´¨éƒ¨å‘ä¸Šè¿è¾“çš„å¼ºåŒ–åŠ¨ç”»
            const transportArrows = [
                {color: nutrientColors.nitrogen.NH4, yOffset: 0},
                {color: nutrientColors.phosphorus, yOffset: 5},
                {color: nutrientColors.potassium, yOffset: -5}
            ];
            
            transportArrows.forEach((arrow, index) => {
                const transport = document.createElementNS("http://www.w3.org/2000/svg", "path");
                transport.setAttribute("d", `M 180,400 L 180,100`);
                transport.setAttribute("fill", "none");
                transport.setAttribute("stroke", arrow.color);
                transport.setAttribute("stroke-width", "2");
                transport.setAttribute("marker-end", "url(#arrowhead)");
                transport.style.animation = `arrowFlow 2s ${index * 0.3}s infinite`;
                transport.classList.add('dynamic-element');
                svg.appendChild(transport);
            });
            
            // æ·»åŠ è¿è¾“è¿‡ç¨‹æ ‡ç­¾
            const transportLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            transportLabel.setAttribute("x", "180");
            transportLabel.setAttribute("y", "80");
            transportLabel.setAttribute("fill", "#2c5530");
            transportLabel.setAttribute("font-size", "14");
            transportLabel.setAttribute("text-anchor", "middle");
            transportLabel.setAttribute("font-weight", "bold");
            transportLabel.textContent = "â†‘ å…»åˆ†å‘ä¸Šè¿è¾“è‡³æ¤ç‰©åœ°ä¸Šéƒ¨åˆ†";
            transportLabel.classList.add('dynamic-element');
            svg.appendChild(transportLabel);
        }
        
        // æ›´æ–°é˜¶æ®µæŒ‡ç¤ºå™¨
        function updateStageIndicator() {
            const indicator = document.getElementById('stageIndicator');
            indicator.textContent = `é˜¶æ®µ ${currentStage + 1}/${animationStages.length}: ${animationStages[currentStage].name}`;
        }
        
        // æ›´æ–°ä¿¡æ¯é¢æ¿
        function updateInfoPanel() {
            const infoText = document.getElementById('infoText');
            infoText.textContent = animationStages[currentStage].description;
        }
        
        // æ§åˆ¶å‡½æ•°
        function playAnimation() {
            if (animationPlaying) {
                pauseAnimation();
                return;
            }
            
            animationPlaying = true;
            document.getElementById('playBtn').textContent = 'æš‚åœ';
            
            let stageStartTime = Date.now();
            
            function animateStage() {
                if (!animationPlaying) return;
                
                const elapsed = Date.now() - stageStartTime;
                const stageDuration = animationStages[currentStage].duration;
                
                if (elapsed >= stageDuration) {
                    // è½¬åˆ°ä¸‹ä¸€é˜¶æ®µ
                    currentStage = (currentStage + 1) % animationStages.length;
                    drawStage(currentStage);
                    stageStartTime = Date.now();
                }
                
                animationTimer = setTimeout(animateStage, 50);
            }
            
            animateStage();
        }
        
        function pauseAnimation() {
            animationPlaying = false;
            clearTimeout(animationTimer);
            document.getElementById('playBtn').textContent = 'æ’­æ”¾/æš‚åœ';
        }
        
        function nextStage() {
            pauseAnimation();
            currentStage = (currentStage + 1) % animationStages.length;
            drawStage(currentStage);
        }
        
        function prevStage() {
            pauseAnimation();
            currentStage = (currentStage - 1 + animationStages.length) % animationStages.length;
            drawStage(currentStage);
        }
        
        function restartAnimation() {
            pauseAnimation();
            currentStage = 0;
            drawStage(currentStage);
        }
        
        function showAllProcesses() {
            pauseAnimation();
            currentStage = 5; // å®Œæ•´è¿‡ç¨‹é˜¶æ®µ
            drawStage(currentStage);
        }
        
        // åˆå§‹åŒ–
        window.onload = function() {
            initSVG();
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('playBtn').addEventListener('click', playAnimation);
            document.getElementById('pauseBtn')
            document.getElementById('prevBtn').addEventListener('click', prevStage);
            document.getElementById('nextBtn').addEventListener('click', nextStage);
            document.getElementById('restartBtn').addEventListener('click', restartAnimation);
            document.getElementById('showAllBtn').addEventListener('click', showAllProcesses);
            
            // æ·»åŠ é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', function(e) {
                switch(e.key) {
                    case 'ArrowLeft': prevStage(); break;
                    case 'ArrowRight': nextStage(); break;
                    case ' ': playAnimation(); break;
                    case 'r': restartAnimation(); break;
                }
            });
        };
    </script>
</body>
</html>